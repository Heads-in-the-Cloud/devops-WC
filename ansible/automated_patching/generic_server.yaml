### Create a generic EC2 server with the Ubuntu 20 image 

- hosts: localhost
  gather_facts: false
  vars_files:
    - ./variables.yaml

  tasks:
  - name: Create ubuntu server
    ec2_instance:
      name: "wc-generic-ubuntu"
      vpc_subnet_id: "{{ SUBNET }}"
      instance_type: t2.micro
      image_id: "{{ AMI }}"
      key_name: "{{ KEY }}"
      security_group: opencertbot-sg
    register: ec2

  - name: Save IP address
    shell: echo "IPv4':' {{ ec2.instances[0].public_ip_address }}" > variables.yaml

  - name: Create route53 record for the server
    route53:
      state: present
      hosted_zone_id: "{{ HOSTED_ZONE }}"
      record: "{{ DOMAIN }}"
      ttl: 300
      type: A
      overwrite: yes
      value: "{{ ec2.instances[0].public_ip_address }}"